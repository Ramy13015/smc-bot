//@version=5
indicator("SMC Bot Simple", shorttitle="SMC", overlay=true)

// Configuration
symbol_input = input.string("BTCUSDT.P", "Symbol", options=["EURUSD", "GBPUSD", "USDJPY", "BTCUSDT.P", "ETHUSDT.P", "SOLUSDT.P"])
webhook_url = input.string("https://smc-gal.onrender.com/tv", "Webhook URL")

// Simple SMC detection
rsi = ta.rsi(14)
atr = ta.atr(14)
volume_avg = ta.sma(volume, 20)
ema21 = ta.ema(close, 21)

// High volume filter
high_vol = volume > volume_avg * 1.5

// SMC conditions
poi_valid = ta.crossover(rsi, 30) or ta.crossunder(rsi, 70)
fvg_open = math.abs(high[1] - low[1]) > atr * 0.5
trend_up = close > ema21
trend_down = close < ema21

// Signals
long_signal = poi_valid and fvg_open and trend_up and high_vol
short_signal = poi_valid and fvg_open and trend_down and high_vol

// Webhook alerts
if long_signal
    event_id = "LONG_" + str.tostring(time)
    payload = '{"event_id":"' + event_id + '","symbol":"' + symbol_input + '","direction":"LONG","price_ctx":{"entry":' + str.tostring(close) + ',"ref_high":' + str.tostring(high) + ',"ref_low":' + str.tostring(low) + '},"atr":' + str.tostring(atr) + ',"flags":{"poi_valid":true,"fvg_open":true,"ob_valid":true,"bos_confirm":true,"choch_confirm":true,"trend_aligned":true}}'
    alert(payload, alert.freq_once_per_bar)

if short_signal
    event_id = "SHORT_" + str.tostring(time)
    payload = '{"event_id":"' + event_id + '","symbol":"' + symbol_input + '","direction":"SHORT","price_ctx":{"entry":' + str.tostring(close) + ',"ref_high":' + str.tostring(high) + ',"ref_low":' + str.tostring(low) + '},"atr":' + str.tostring(atr) + ',"flags":{"poi_valid":true,"fvg_open":true,"ob_valid":true,"bos_confirm":true,"choch_confirm":true,"trend_aligned":true}}'
    alert(payload, alert.freq_once_per_bar)

// Visual indicators
plotshape(long_signal, style=shape.triangleup, location=location.belowbar, color=color.green, size=size.normal)
plotshape(short_signal, style=shape.triangledown, location=location.abovebar, color=color.red, size=size.normal)
plotshape(high_vol, style=shape.circle, location=location.bottom, color=color.orange, size=size.tiny)

// Display info
plot(ema21, color=color.blue, title="EMA21")
bgcolor(high_vol ? color.new(color.yellow, 90) : na, title="High Volume")